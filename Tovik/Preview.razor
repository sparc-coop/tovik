@page "/preview"
@layout HomeLayout
@using Tovik.Translation

<article>
    <header>
        <input type="text" value="@Url" disabled />
        <Sparc.Blossom.Content.LanguageSelector InitialLanguageId="@PreviewLang" OnLanguageChanged="UpdateLanguage" />
    </header>
    <iframe srcdoc="@PreviewHtml">
    </iframe>
</article>

@inject TovikCrawler Crawler
@code {
    MarkupString PreviewHtml;
    [Parameter]
    [SupplyParameterFromQuery] public required string Url { get; set; }
    [Parameter]
    [SupplyParameterFromQuery] public string? PreviewLang { get; set; }
    Sparc.Blossom.Content.LanguageSelector? LanguageSelector;

    async Task UpdateLanguage(Sparc.Blossom.Content.Language lang)
    {
        PreviewLang = lang.Id;
        PreviewHtml = new MarkupString(await Crawler.PreviewAsync(Url, lang.Id));
    }
}
