<form @onsubmit=Add>
    <label>
        <input type="text" placeholder="Enter your domain name" @bind="NewDomain" @bind:event="oninput" />
    </label>

    <button class="add-btn primary-btn" type="submit" disabled="@IsVerifying">
        @(ButtonText ?? "Add Domain")
    </button>
</form>

@if (Error != null)
{
    <div class="error-message">@Error</div>
}

@inject Tovik.Domains.TovikDomains TovikDomains
@code {
    [Parameter] public string? Domain { get; set; }
    [Parameter] public string? ButtonText { get; set; }
    bool IsVerifying;
    string NewDomain = "";
    string? Error;
    
    protected override void OnParametersSet()
    {
        if (!string.IsNullOrWhiteSpace(Domain))
            NewDomain = Domain;
	}

    private async Task Add()
    {
        IsVerifying = true;
        StateHasChanged();

        try
        {
            var newDomain = await TovikDomains.RegisterAsync(NewDomain);
            NewDomain = "";
            Nav.NavigateTo($"/app/{newDomain.Id}");
        }
        catch (Exception ex)
        {
            Error = ex.Message;
            NewDomain = "";
        }

        IsVerifying = false;
    }
}
